/**
 * Angular-Validation Directive and Service (ghiscoding)
 * https://github.com/ghiscoding/angular-validation
 * @author: Ghislain B.
 * @version: 1.3.9
 * @license: MIT
 * @date: Sat Mar 21 2015 17:40:22 GMT-0400 (Eastern Daylight Time)
 */
angular.module("ghiscoding.validation").factory("validationCommon",["$timeout","$translate","validationRules",function(t,a,e){function r(){var t=this,a={};t.validators=[],t.typingLimit=c,t.validatorAttrs.hasOwnProperty("debounce")?t.typingLimit=parseInt(t.validatorAttrs.debounce,10):t.validatorAttrs.hasOwnProperty("typingLimit")&&(t.typingLimit=parseInt(t.validatorAttrs.typingLimit,10));var r=t.validatorAttrs.hasOwnProperty("rules")?t.validatorAttrs.rules:t.validatorAttrs.validation;if(r.indexOf("regex:")>=0){var i=r.match("regex:(.*?):regex");if(i.length<2)throw'Regex validator within the validation needs to be define with an opening "regex:" and a closing ":regex", please review your validator.';var s=i[1].split(":=");a={message:s[0],pattern:s[1]},r=r.replace(i[0],"regex:")}var n=r.split("|");if(n){t.bFieldRequired=n.indexOf("required")>=0?!0:!1;for(var l=0,o=n.length;o>l;l++){var d=n[l].split(":");t.validators[l]=e.getElementValidators(d[0],d[1],a)}}return t}function i(t,a,e,r){this.scope=t,this.elm=a,this.ctrl=r,this.validatorAttrs=e,this.defineValidation()}function s(){var t=this;return t.bFieldRequired}function n(t,e,r){var i=this;if("undefined"==typeof i.elm.attr("name"))throw'Angular-Validation Service requires you to have a (name="") attribute on the element to validate... Your element is: ng-model="'+i.elm.attr("ng-model")+'"';var s="undefined"!=typeof r&&r?a.instant(t):t,n=i.elm.attr("name").replace(/[|&;$%@"<>()+,\[\]\{\}]/g,""),l="undefined"==typeof e?!1:!0,o=null;if(i.validatorAttrs.hasOwnProperty("validationErrorTo")){var d=i.validatorAttrs.validationErrorTo.charAt(0),p="."===d||"#"===d?i.validatorAttrs.validationErrorTo:"#"+i.validatorAttrs.validationErrorTo;o=angular.element(document.querySelector(p))}else o=angular.element(document.querySelector(".validation-"+n));l&&!e&&(i.ctrl.$dirty||i.ctrl.$touched)?o.length>0?o.text(s):i.elm.after('<span class="validation validation-'+n+' text-danger">'+s+"</span>"):o.text("")}function l(t,e){for(var r,i=this,s=!0,n=!0,l="",d=0,v=i.validators.length;v>d;d++){if("conditionalDate"===i.validators[d].type){if(r=new RegExp(i.validators[d].pattern,"i"),s="\\S+"!==i.validators[d].pattern||"undefined"!=typeof t&&null!==t?r.test(t):!1){var c=i.validators[d].dateType,g=p(t,c).getTime();if(2==i.validators[d].params.length){var m=p(i.validators[d].params[0],c).getTime(),f=p(i.validators[d].params[1],c).getTime(),h=u(i.validators[d].condition[0],g,m),y=u(i.validators[d].condition[1],g,f);s=h&&y?!0:!1}else{var b=p(i.validators[d].params[0],c).getTime();s=u(i.validators[d].condition,g,b)}}}else if("conditionalNumber"===i.validators[d].type)if(2==i.validators[d].params.length){var h=u(i.validators[d].condition[0],parseFloat(t),parseFloat(i.validators[d].params[0])),y=u(i.validators[d].condition[1],parseFloat(t),parseFloat(i.validators[d].params[1]));s=h&&y?!0:!1}else s=u(i.validators[d].condition,parseFloat(t),parseFloat(i.validators[d].params[0]));else if("match"===i.validators[d].type){var O=i.validators[d].params[0],R=i.scope.$eval(O);s=R===t}else i.elm.prop("disabled")?s=!0:"string"==typeof t&&""===t&&"NUMBER"===i.elm.prop("type").toUpperCase()?(l=a.instant("INVALID_KEY_CHAR"),s=!1):(r=new RegExp(i.validators[d].pattern,"i"),s="\\S+"!==i.validators[d].pattern||"undefined"!=typeof t&&null!==t?r.test(t):!1);if(!s&&(n=!1,l+=a.instant(i.validators[d].message),"undefined"!=typeof i.validators[d].params))for(var E=0,S=i.validators[d].params.length;S>E;E++)"match"===i.validators[d].type&&S>1&&0===E||(l=l.replace(":param",i.validators[d].params[E]))}return o(i,i.elm.attr("name"),a.instant(l)),e&&i.updateErrorMsg(l,n),n}function o(t,a,e){var r=d(g,"field",a);if(r>=0&&""===e)g.splice(r,1);else if(""!==e){var i={field:a,message:e};r>=0?g[r]=i:g.push(i)}t.scope.$validationSummary=g;var s=angular.element(document.querySelector("form")).attr("name");s&&(t.scope[s].$validationSummary=g)}function d(t,a,e){for(var r=0;r<t.length;r++)if(t[r][a]===e)return r;return-1}function p(t,a){var e="",r="-",i=[],s=[],n="",l="",o="";switch(a.toUpperCase()){case"EURO_LONG":case"EURO-LONG":e=t.substring(0,10),r=t.substring(2,3),i=v(e,r),o=i[0],l=i[1],n=i[2],s=t.length>8?t.substring(9).split(":"):null;break;case"UK":case"EURO":case"EURO_SHORT":case"EURO-SHORT":case"EUROPE":e=t.substring(0,8),r=t.substring(2,3),i=v(e,r),o=i[0],l=i[1],n=parseInt(i[2])<50?"20"+i[2]:"19"+i[2],s=t.length>8?t.substring(9).split(":"):null;break;case"US_LONG":case"US-LONG":e=t.substring(0,10),r=t.substring(2,3),i=v(e,r),l=i[0],o=i[1],n=i[2],s=t.length>8?t.substring(9).split(":"):null;break;case"US":case"US_SHORT":case"US-SHORT":e=t.substring(0,8),r=t.substring(2,3),i=v(e,r),l=i[0],o=i[1],n=parseInt(i[2])<50?"20"+i[2]:"19"+i[2],s=t.length>8?t.substring(9).split(":"):null;break;case"ISO":default:e=t.substring(0,10),r=t.substring(4,5),i=v(e,r),n=i[0],l=i[1],o=i[2],s=t.length>10?t.substring(11).split(":"):null}var d=s&&3===s.length?s[0]:0,p=s&&3===s.length?s[1]:0,u=s&&3===s.length?s[2]:0;return new Date(n,l-1,o,d,p,u)}function v(t,a){var e=[];switch(a){case"/":e=t.split("/");break;case".":e=t.split(".");break;case"-":default:e=t.split("-")}return e}function u(t,a,e){var r=!1;switch(t){case"<":r=e>a?!0:!1;break;case"<=":r=e>=a?!0:!1;break;case">":r=a>e?!0:!1;break;case">=":r=a>=e?!0:!1;break;case"!=":case"<>":r=a!=e?!0:!1;break;case"=":case"==":r=a==e?!0:!1;break;default:r=!1}return r}var c=1e3,g=[],m=function(t,a,e,r){this.timer=null,this.bFieldRequired=!1,this.validators=[],this.typingLimit=c,this.scope=t,this.elm=a,this.ctrl=r,this.validatorAttrs=e,t&&a&&e&&r&&this.defineValidation()};return m.prototype.defineValidation=r,m.prototype.isFieldRequired=s,m.prototype.initialize=i,m.prototype.updateErrorMsg=n,m.prototype.validate=l,m}]);